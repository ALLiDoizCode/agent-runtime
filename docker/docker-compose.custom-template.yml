# Docker Compose Custom Topology Template
# Use this template to create your own custom ILP network topology
#
# Instructions:
# 1. Create YAML configuration files for each connector in the examples/ directory
#    - See examples/linear-3-nodes-*.yaml for reference
#    - Define nodeId, btpServerPort, peers, and routes
# 2. Copy this file to a new name (e.g., docker-compose.my-topology.yml)
# 3. Modify the number of connector services as needed
# 4. Update volume mounts to point to your YAML config files
# 5. Update CONFIG_FILE environment variable
# 6. Adjust port mappings to match your YAML config files
# 7. Start your custom topology: docker-compose -f <your-file>.yml up -d
#
# Configuration File Format:
# Each connector needs a YAML config file with the following structure:
#   nodeId: string                     # Unique identifier
#   btpServerPort: number              # Port for BTP server (1-65535)
#   logLevel: string                   # Optional: debug|info|warn|error
#   healthCheckPort: number            # Optional: default 8080
#   peers:                             # List of peer connectors
#     - id: string                     # Peer identifier
#       url: string                    # WebSocket URL (ws://host:port)
#       authToken: string              # Shared secret
#   routes:                            # Routing table entries
#     - prefix: string                 # ILP address prefix
#       nextHop: string                # Peer ID
#       priority: number               # Optional: default 0
#
# See examples/README.md for detailed configuration documentation

version: '3.8'

services:
  # TODO: Add your connector services here
  # Copy and modify the template below for each connector

  # Example Connector 1
  connector-example-1:
    image: connector
    container_name: connector-example-1           # TODO: Change to unique name
    environment:
      CONFIG_FILE: /app/config.yaml               # Path to config file in container
      NODE_ID: connector-example-1                # TODO: Match nodeId in YAML config
      LOG_LEVEL: info
    volumes:
      # TODO: Create examples/my-topology-node1.yaml and mount it here
      - ../examples/my-topology-node1.yaml:/app/config.yaml:ro
    ports:
      - "3000:3000"                               # TODO: Match btpServerPort in YAML config
    networks:
      - agent-network
    restart: unless-stopped
    healthcheck:
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Example Connector 2
  # TODO: Uncomment and customize this service
  # connector-example-2:
  #   image: connector
  #   container_name: connector-example-2
  #   environment:
  #     CONFIG_FILE: /app/config.yaml
  #     NODE_ID: connector-example-2
  #     LOG_LEVEL: info
  #   volumes:
  #     - ../examples/my-topology-node2.yaml:/app/config.yaml:ro
  #   ports:
  #     - "3001:3001"
  #   networks:
  #     - agent-network
  #   depends_on:
  #     - connector-example-1
  #   restart: unless-stopped
  #   healthcheck:
  #     interval: 30s
  #     timeout: 10s
  #     retries: 3
  #     start_period: 10s

  # TODO: Add more connector services as needed
  # Follow the pattern above, incrementing ports and creating corresponding YAML configs

networks:
  agent-network:
    driver: bridge

# Tips for Custom Topologies:
#
# Linear Chain (A → B → C):
# - A has empty peers array (entry point, accepts incoming only)
# - B has peers: [connector-a, connector-c]
# - C has empty peers array (exit point, accepts incoming only)
# - See examples/linear-3-nodes-*.yaml
#
# Star/Hub-and-Spoke:
# - Hub has empty peers array (accepts incoming from all spokes)
# - Each spoke has peers: [connector-hub]
# - Centralized routing through hub
# - See examples/hub-spoke-*.yaml
#
# Full Mesh:
# - Each connector has all other connectors in peers array
# - N(N-1)/2 total bidirectional connections
# - Redundant paths for resilience
# - See examples/mesh-4-nodes-*.yaml
#
# Ring Topology (A → B → C → A):
# - Each connector has peers: [next-in-ring]
# - Last connector's peers includes first connector
# - Creates circular routing path
#
# Custom Hybrid:
# - Mix topologies as needed
# - Ensure routes reference valid peers
# - Consider routing complexity
# - Plan for failure scenarios
#
# Configuration Best Practices:
# - Use consistent naming: connector-{name}
# - Port allocation: increment from 3000
# - Shared secrets: secret-{source}-to-{destination}
# - Validate configs with: npm test --workspace=packages/connector
