# Docker Compose configuration for hub-and-spoke ILP network
# Topology: Central hub with 3 spoke connectors
#
#           Hub (Port 3000)
#          /  |  \
#         /   |   \
#        /    |    \
#     Spoke1 Spoke2 Spoke3
#    (3001) (3002) (3003)
#
# Connections: Hub ‚Üê Spokes (spokes initiate connections to hub)
# All traffic must route through the hub
#
# Usage:
#   Start: docker-compose -f docker/docker-compose.hub-spoke.yml up -d
#   Logs:  docker-compose -f docker/docker-compose.hub-spoke.yml logs -f
#   Stop:  docker-compose -f docker/docker-compose.hub-spoke.yml down
#
# Prerequisites:
#   Build the connector image: docker build -t ilp-connector .
#
# Configuration:
#   Each connector loads its configuration from a YAML file mounted as a volume.
#   Configuration files: examples/hub-spoke-{hub,spoke1,spoke2,spoke3}.yaml
#   This topology provides a centralized routing architecture where the hub
#   controls all inter-spoke communication.

version: '3.8'

services:
  # Hub - Central routing node
  connector-hub:
    image: ilp-connector
    container_name: connector-hub
    environment:
      CONFIG_FILE: /app/config.yaml
      NODE_ID: connector-hub
      LOG_LEVEL: info
    volumes:
      - ../examples/hub-spoke-hub.yaml:/app/config.yaml:ro
    ports:
      - "3000:3000"
    networks:
      - ilp-network
    restart: unless-stopped
    healthcheck:
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Spoke 1
  connector-spoke1:
    image: ilp-connector
    container_name: connector-spoke1
    environment:
      CONFIG_FILE: /app/config.yaml
      NODE_ID: spoke-1
      LOG_LEVEL: info
    volumes:
      - ../examples/hub-spoke-spoke1.yaml:/app/config.yaml:ro
    ports:
      - "3001:3001"
    networks:
      - ilp-network
    depends_on:
      - connector-hub
    restart: unless-stopped
    healthcheck:
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Spoke 2
  connector-spoke2:
    image: ilp-connector
    container_name: connector-spoke2
    environment:
      CONFIG_FILE: /app/config.yaml
      NODE_ID: spoke-2
      LOG_LEVEL: info
    volumes:
      - ../examples/hub-spoke-spoke2.yaml:/app/config.yaml:ro
    ports:
      - "3002:3002"
    networks:
      - ilp-network
    depends_on:
      - connector-hub
    restart: unless-stopped
    healthcheck:
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Spoke 3
  connector-spoke3:
    image: ilp-connector
    container_name: connector-spoke3
    environment:
      CONFIG_FILE: /app/config.yaml
      NODE_ID: spoke-3
      LOG_LEVEL: info
    volumes:
      - ../examples/hub-spoke-spoke3.yaml:/app/config.yaml:ro
    ports:
      - "3003:3003"
    networks:
      - ilp-network
    depends_on:
      - connector-hub
    restart: unless-stopped
    healthcheck:
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  ilp-network:
    driver: bridge
