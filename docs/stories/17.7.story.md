<!-- Powered by BMAD™ Core -->

# Story 17.7: Task Delegation Result (Kind 6900)

## Status

Draft

## Story

**As a** connector operator running an AI agent,
**I want** Kind 6900 task delegation results with runtime metrics,
**So that** task results include execution metadata (runtime, token counts) enabling performance monitoring and optimization.

## Acceptance Criteria

1. Create Kind 6900 events (5900 + 1000)
2. Include standard DVM result tags
3. Add `runtime` tag (execution time in ms)
4. Add `tokens` tag (input/output token counts if applicable)
5. Add `status` tag (success/error/partial)
6. Content contains result data
7. Sign with agent's Nostr key

## Tasks / Subtasks

- [ ] Task 1: Extend result types (AC: 1, 3, 4, 5)
  - [ ] Create `TaskDelegationResult` interface
  - [ ] Add `runtime`, `tokens`, `status` fields

- [ ] Task 2: Update result formatter (AC: 2, 3, 4, 5, 6, 7)
  - [ ] Extend `formatDVMJobResult()` for Kind 6900
  - [ ] Add runtime/tokens/status tags
  - [ ] Create unsigned event template

- [ ] Task 3: Tests (AC: all)
  - [ ] Unit tests for formatting
  - [ ] Integration test with Kind 5900 → 6900 flow

## Dev Notes

**Kind 6900 Structure:**

```json
{
  "kind": 6900,
  "tags": [
    ["e", "<request-event-id>"],
    ["p", "<requester-pubkey>"],
    ["status", "success"],
    ["amount", "5000"],
    ["runtime", "1250"],
    ["tokens", "150", "200"]
  ],
  "content": "Task result data"
}
```

[Source: docs/prd/epic-17-nip-90-dvm-compatibility.md#story-177]

---

## Change Log

| Date       | Version | Description   | Author |
| ---------- | ------- | ------------- | ------ |
| 2026-01-28 | 1.0     | Story created | SM     |

---

## Dev Agent Record

[To be filled by Dev Agent]

---

## QA Results

[To be filled by QA Agent]
