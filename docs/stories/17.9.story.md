<!-- Powered by BMADâ„¢ Core -->

# Story 17.9: Timeout & Retry Logic

## Status

Draft

## Story

**As a** connector operator running an AI agent,
**I want** timeout enforcement and retry logic for task delegation,
**So that** tasks don't hang indefinitely and transient failures are automatically retried with exponential backoff.

## Acceptance Criteria

1. Enforce `timeout` tag value during execution
2. Cancel tasks exceeding timeout
3. Return `failed` status with timeout reason via Kind 7000
4. Configurable max retries (default 3)
5. Exponential backoff between retries
6. Track retry count in task metadata
7. Final failure after max retries returns Kind 6900 with error

## Tasks / Subtasks

- [ ] Task 1: Implement timeout enforcement (AC: 1, 2, 3)
  - [ ] Wrap task execution with timeout
  - [ ] Cancel on timeout
  - [ ] Emit Kind 7000 failure

- [ ] Task 2: Implement retry logic (AC: 4, 5, 6)
  - [ ] Retry loop with max attempts
  - [ ] Exponential backoff calculation
  - [ ] Retry metadata tracking

- [ ] Task 3: Error result formatting (AC: 7)
  - [ ] Create Kind 6900 error result
  - [ ] Include retry history

- [ ] Task 4: Tests (AC: all)
  - [ ] Test timeout cancellation
  - [ ] Test retry backoff
  - [ ] Test max retries exhausted

## Dev Notes

**Timeout Enforcement:**

```typescript
async executeWithTimeout(request, timeoutMs) {
  return Promise.race([
    this.execute(request),
    this.timeout(timeoutMs)
  ]);
}
```

**Retry Backoff:**

```typescript
backoffMs(attempt: number): number {
  return Math.min(1000 * Math.pow(2, attempt), 30000);
}
// attempt 0: 1000ms
// attempt 1: 2000ms
// attempt 2: 4000ms
// attempt 3: 8000ms
```

[Source: docs/prd/epic-17-nip-90-dvm-compatibility.md#story-179]

---

## Change Log

| Date       | Version | Description   | Author |
| ---------- | ------- | ------------- | ------ |
| 2026-01-28 | 1.0     | Story created | SM     |

---

## Dev Agent Record

[To be filled by Dev Agent]

---

## QA Results

[To be filled by QA Agent]
